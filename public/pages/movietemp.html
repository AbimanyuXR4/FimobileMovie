<template>
    <div class="page light">
        <div class="navbar">
            <div class="navbar-inner">
                <div class="left">
                    <a href="#" class="link icon-only panel-open" data-panel="left">
                        <span class="new-notification"></span>
                        <i class="icon material-icons">menu</i>
                    </a>
                </div>
                <div class="title"><img src="img/logo-header.png" alt="svelte-logo" class="svelte-logo"> </div>
                <div class="right">
                    <a href="/noticationslist/" class="link icon-only">
                        <i class="material-icons">notifications_none</i><span class="counts">9+</span>
                    </a>
                </div>
    
                <form data-search-container=".components-list" data-search-in="a" class="searchbar searchbar-expandable searchbar-components searchbar-init">
                    <div class="searchbar-inner">
                        <div class="searchbar-input-wrap">
                            <input type="search" placeholder="Search components">
                            <i class="searchbar-icon"></i>
                            <span class="input-clear-button"></span>
                        </div>
                        <span class="searchbar-disable-button if-not-aurora"></span>
                    </div>
                </form>
            </div>
        </div>

        <!-- Content -->
        <div class="tabs">
      
        <div id="tab-1" class="page-content tab tab-active">  

            <div class="block">
              <div class="card wrapperh bg-dar shadow mt-4 h-90 responsive" style="background: url(http://image.tmdb.org/t/p/w1280{{movies.heroImage.backdrop_path}});background-size: cover; background-position: center;">
                <div class="card-content wrapperh card-content-padding ">
                            <div class="contenth" style="margin-top: 250px;">
                              <div class="text">
                                <h2 style="color: white;">
                                  {{movies.heroImage.original_title}} 
                                </h2>
                              </div>
                            </div>
                </div>
            </div>
            <!-- </div> -->

            <form class="searchbar">
                <div class="searchbar-inner">
                  <div class="searchbar-input-wrap">
                    <input type="search" placeholder="Search Movie">
                    <i class="searchbar-icon"></i>
                    <span class="input-clear-button"></span>
                  </div>
                  <span class="searchbar-disable-button if-not-aurora">Cancel</span>
                </div>
            </form>
            <div class="block">
                <div class="row text-align-center mt-4 color-black">
                    
                    <div class="col">
                        <div class="card shadow border-0 mb-4" >
                            <a href="/" @click="OI({{movies.movies[0].id}})" class="popup-open" data-popup=".best-movie">
                                <div class="card-content card-content-padding h-190" style="background: url(http://image.tmdb.org/t/p/w1280{{movies.heroImage.poster_path}});background-size: cover; background-position: center;border-radius: 10px;"></div>
                            </a>
                        </div>
                    </div>
                    
                    <div class="col">
                        <div class="card shadow border-0 mb-4" >
                            <a href="/" @click="OI({{movies.movies[1].id}})" class="popup-open" data-popup=".best-movie">
                                <div class="card-content card-content-padding h-190" style="background: url(http://image.tmdb.org/t/p/w1280{{movies.movies[1].poster_path}});background-size: cover; background-position: center;border-radius: 10px;"></div>
                            </a>
                        </div>
                    </div>

                </div>
                <div class="row text-align-center color-black">
                    
                    <div class="col">
                        <div class="card shadow border-0 mb-4" >
                            <a href="/" @click="OI({{movies.movies[2].id}})" class="popup-open" data-popup=".best-movie">
                                <div class="card-content card-content-padding h-190" style="background: url(http://image.tmdb.org/t/p/w1280{{movies.movies[2].poster_path}});background-size: cover; background-position: center;border-radius: 10px;"></div>
                            </a>
                        </div>
                    </div>

                    <div class="col">
                        <div class="card shadow border-0 mb-4">
                            <a href="/" @click="OI({{movies.movies[3].id}})" class="popup-open" data-popup=".best-movie">
                                <div class="card-content card-content-padding h-190" style="background: url(http://image.tmdb.org/t/p/w1280{{movies.movies[3].poster_path}});background-size: cover; background-position: center;border-radius: 10px;"></div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
      </div>
    </div>
    </div>
</template>

<script>

const API_URL = 'https://api.themoviedb.org/3/';
const API_KEY = '7e97f4650ad722d5b44df91dee514674';

const SEARCH_BASE_URL = `${API_URL}search/movie?api_key=${API_KEY}&query=`;
const POPULAR_BASE_URL = `${API_URL}movie/popular?api_key=${API_KEY}`;
const MOVIE_ENDPOINT = id => `${API_URL}movie/${id}?api_key=${API_KEY}`;
const CREDITS_ENDPOINT = id => `${API_URL}movie/${id}/credits?api_key=${API_KEY}`;

const IMAGE_BASE_URL = 'http://image.tmdb.org/t/p/';
// Sizes: w300, w780, w1280, original
const BACKDROP_SIZE = 'w1280';
// w92, w154, w185, w342, w500, w780, original
const POSTER_SIZE = 'w500';

  return{
          data: async function(){
            var movies = {movies: []};
            const url_Api = 'https://api.themoviedb.org/3/movie/popular?api_key=7e97f4650ad722d5b44df91dee514674&page=1'; 
            try {
                    movies = await fetchMovies(movies, url_Api);
                    console.log(movies);
                    console.log(movies.heroImage.id)
                } catch (err) {
                    console.log('error');
                }

            async function fetchMovies(movies, url) {
                const result = await (await fetch(url)).json();
                return {
                    ...movies,
                    movies: url ? [...movies.movies, ...result.results] : [...result.results],
                    heroImage: movies.heroImage || result.results[0],
                    currentPage: result.page,
                    totalPages: result.total_pages
                }
            }

            return{
              movies:movies
            }
        },
        methods: {
          OI: function(params){
                console.log(params);
                window.localStorage.setItem('id', params)
            }
        }
  }
</script>